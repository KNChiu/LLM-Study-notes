---
description: >-
  遵循傳統的過程，包括 Indexing ( 索引 ) → Retrieval ( 檢索 ) → Generation ( 生成
  )，也被稱為「檢索-讀取」框架 。
---

# Naive RAG

## 框架與流程說明

### In**dexing ( 索引 )**

清理和提取 PDF、HTML、Word 等不同格式的原始資料，將其轉換為統一的純文字格式。文本被分割成更小的、易於理解的區塊 (chunks)。然後將區塊編碼 ( encoded ) 為向量表示並儲存在向量資料庫中。此步驟對於在後續檢索階段實現高效的相似性搜尋至關重要。

*   **Chunk**

    > 較大的區塊更多的上下文，但也會產生更多的雜訊、更長的處理時間和更高的成本。較小的區塊無法完全傳達必要的上下文，但它們確實具有較少的雜訊。
*   **Metadata**

    > 使用頁碼、檔案名稱、作者、類別時間戳等元資料資訊來豐富區塊。可以篩選檢索而限制檢索的範圍。在檢索過程中為文件時間戳記分配不同的權重可以實現時間感知的RAG，避免資訊過時。
*   **Structural**

    > 建立文件的層次關係可以增強資訊檢索和處理，文件以父子關係排列，區塊連結，將摘要儲存在每個節點上，有助於快速遍歷資料並協助 RAG 系統確定要提取哪些區塊，這可以減輕由塊提取問題引起的錯覺。

### **Retrieval ( 檢索 )**

將查詢內容編碼後轉換為向量表示。計算查詢向量與索引語料庫中的區塊向量之間的相似性分數。系統優先考慮並檢索與查詢最相似的前 K 個區塊。這些區塊隨後被用作提示中的擴展上下文。

*   **Query Optimization**

    > 由於自然語言複雜性。在處理專業詞彙或具有多種意義的模糊縮寫時通常會遇到困難，將單一查詢擴展到多個查詢可以豐富查詢的內容，提供進一步的上下文來解決任何缺乏特定細微差別的問題，從而確保產生的答案的最佳相關性。
*   **Embedding**

    > 透過計算問題和文件區塊的編碼(**Embedding**)之間的相似度(cosine similarity)，在上下文與預訓練語料庫顯著偏離的情況下，特別是在高度專業化的學科中，充滿專有術語的領域，在領域數據集上微調編碼模型對於減輕差異至關重要。

### **Generation ( 生成 )**

將編碼後的查詢和選定的文件合成為一個連貫的提示。LLM的回答可能會根據特定任務的標準而有所不同，利用其固有的參數知識或限制其對所提供文件中包含的資訊的回應。在持續對話的情況下，對話歷史可以整合到提示中，使模型能夠有效地進行多輪對話互動。

*   **Reranking**

    > 重新排序從根本上對文檔區塊進行重新排序，可以使用基於規則的方法 (取決於多樣性、相關性等預定義指標)，或基於模型的方法(等專門的重排序模型)。
*   **Context Selection/Compression (選擇/壓縮)**

    > 過多的上下文可能會引入更多雜訊，利用 GPT-2 Small 或 LLaMA-7B 等小型語言模型 (SLM) 來檢測和刪除不重要的標記，將其轉換為人類難以理解但易於模型理解的文檔，除了壓縮上下文減少文件數也有助於提高模型的準確性，SLM 充當過濾器，而 LLM充當重新排序代理，透過LLM評估並過濾掉相關性較差的文件。
*   LLM Fine-tuning

    > 當LLMs缺乏特定領域的資料時，可以進行有針對性的微調為LLM提供額外的知識，為了使輸出與人類或檢索者偏好保持一致，手動註釋答案，然後透過強化學習提供回饋。
*   **Augmentation process**

    標準步驟涉及單一次檢索步驟然後生成，導致效率低下，難以滿足需要多步驟推理的複雜問題，因為提供的資訊範圍有限。

    *   Iterative Retrieval (迭代檢索)

        > 根據初始查詢和所有產生的文本對知識庫進行重複搜尋的過程，在檢索和生成之間交替，允許在每一步中從知識庫中獲得更豐富、更有針對性的上下文，但可能會受到語義不連續和不相關資訊累積的影響。
    *   Recursive Retrieval (遞迴檢索)

        > 透過回饋循環逐漸收斂最相關的資訊來增強搜尋，逐步細化使用者查詢並將問題分解為子問題，然後透過檢索和產生不斷解決複雜問題，有系統地最佳化查詢中不明確的部分。它在複雜的搜尋場景中特別有用。
    *   Adaptive Retrieval (自適應檢索)

        > 自適應檢索使 RAG 系統能夠自主確定是否需要外部知識檢索以及何時停止檢索和生成，通常利用 LLM 生成的特殊 tokens (主動使用檢索器自助詢問等技術，並採用少量提示來啟動搜尋查詢)進行控制，允許模型評估其輸出包含「檢索」和「評論家」。

<figure><img src="../.gitbook/assets/image (4) (1).png" alt="" width="272"><figcaption><p>Naive RAG</p></figcaption></figure>

### 缺點與挑戰

*   Retrieval Challenges

    > 檢索階段在精確度和召回率方面遇到困難，選擇錯誤不相關的區塊，遺失關鍵資訊。
*   Generation Difficulties.

    > 在產生回應時，模型可能會面臨幻覺問題，產生與檢索到的上下文不相關的內容。也可能受到輸出的不相關性、毒性或偏差的影響，從而降低反應的品質和可靠性。
*   Augmentation Hurdles.

    > 檢索到的信息與不同的任務整合可能具有挑戰性，會導致輸出脫節或不連貫。當從多個來源檢索類似資訊時，可能導致重複回應。確定各個段落的重要性和相關性並確保風格和語氣的一致性進一步增加了複雜性。面對複雜的問題，基於原始查詢的單一檢索可能不足以獲取足夠的上下文資訊。


*

    <figure><img src="../.gitbook/assets/image (4).png" alt=""><figcaption><p>不同流程說明</p></figcaption></figure>
